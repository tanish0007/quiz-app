<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Test</title>
</head>
<body>
    <div class="container">
        <nav>
            <h1>Online Test</h1>
            <div class="user-details">
                <span class="user-name"></span>
                <span class="user-age"></span>
            </div>
        </nav>

        <!-- <div>
            <button id="1">1</button>
            <button id="2">2</button>
            <button id="3">3</button>
            <button id="4">4</button>
            <button id="5">5</button>
            <button id="6">6</button>
            <button id="7">7</button>
            <button id="8">8</button>
            <button id="9">9</button>
            <button id="10">10</button>
        </div> -->
        <main class="test-container">
            <!-- <div class="test-que">
                <p id="1" class="que">Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptate, earum inventore laboriosam dolorum corporis harum mollitia. Repudiandae tempora, cumque sint illo consequuntur pariatur ab, corporis mollitia maiores facilis corrupti reiciendis recusandae soluta itaque error enim, officiis blanditiis provident! Corrupti at nisi laudantium expedita atque quia nesciunt eaque voluptatum, iste aliquid!</p>
                <div class="options">
                    <input type="radio" id="A" value="Option A" name="option"> <label for="A">Option A</label>
                    <input type="radio" id="B" value="Option B" name="option"> <label for="B">Option B</label>
                    <input type="radio" id="C" value="Option C" name="option"> <label for="C">Option C</label>
                    <input type="radio" id="D" value="Option D" name="option"> <label for="D">Option D</label>
                </div>
            </div> -->

            <button id="save-ans">Save & Next</button>
        </main>
    </div>

    <script>
        const user = JSON.parse(sessionStorage.getItem('user'));
        if(!user){
            window.location.href = 'index.html';
        }
        
        let questionsData = [];

        console.log(user.username, user.age);
        document.querySelector('.user-name').innerHTML = user.username;
        document.querySelector('.user-age').innerHTML = user.age;

        async function fetchQuestions(){
            try{
                const res = await fetch(`http://localhost:8080/testData`);
                const data = await res.json();
                console.log(data.testData)
                return data.testData;

            } catch(err) {
                console.log(err);
            }
        }
        fetchQuestions();

        async function verifyAns(quesId, answer){
            try{
                const res = await fetch('http://localhost:8080/verify',{
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: {
                        queId: quesId,
                        ans: answer
                    }
                });
                const data = await res.json();
                console.log(data);

            } catch(err) {
                console.log(err);
            }
        }

        const testContainer = document.querySelector('.test-container');
        const answers = document.querySelectorAll('input[name="option"]');
        const saveAnsBtn = document.querySelector('#save-ans');
        const que = document.querySelector('.que');

        const results = [];

        saveAnsBtn.addEventListener('click', async () => {
            try{
                let answer = null;
                const queId = parseInt(que.id);

                for(let i=0; i<answers.length; i++){
                    if(answers[i].checked){
                        answer = answers[i].value;
                    }
                }
                if(answer === null){
                    console.log('Please select one');
                }else {
                    console.log(answer);
                }

                const isCorrect = await verifyAns(queId, answer);

                const result = {id: queId, isCorrect: isCorrect};
                results.push(result);
            }
            catch(err){
                console.log(err);
            }
        })


        document.addEventListener('DOMContentLoaded', async() => {
            try{
                const questions = await fetchQuestions();
                // console.log(questions);
                questions.forEach((question) => {
                    addToDom(question);
                })
            } catch(err){
                console.log(err);
            }
        })

        function addToDom(question){
            const div = document.createElement('div');
            div.innerHTML = `
                <p id="${question.id}" class="que">${question.que}</p>
                <div class="options">
                    <input type="radio" id="A" value="${question.options[0]}" name="option"> <label for="A">${question.options[0]}</label>
                    <input type="radio" id="B" value="${question.options[1]}" name="option"> <label for="B">${question.options[1]}</label>
                    <input type="radio" id="C" value="${question.options[2]}" name="option"> <label for="C">${question.options[2]}</label>
                    <input type="radio" id="D" value="${question.options[3]}" name="option"> <label for="D">${question.options[3]}</label>
                </div>
            `;
            div.classList.add('test-que');
            
            testContainer.appendChild('div');
        }
    </script>
</body>
</html>